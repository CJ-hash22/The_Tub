<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Tub</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 100%);
            color: #fff;
            overflow-x: hidden;
        }

        /* Vehicle Selection Screen */
        .vehicle-selection {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .vehicle-selection h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #1e90ff, #0066cc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
        }

        .vehicle-selection p {
            font-size: 1.2rem;
            margin-bottom: 3rem;
            opacity: 0.8;
            text-align: center;
        }

        .vehicle-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            max-width: 800px;
            width: 100%;
        }

        .vehicle-option {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .vehicle-option:hover {
            border-color: #1e90ff;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(30, 144, 255, 0.3);
        }

        .vehicle-option h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .vehicle-option p {
            opacity: 0.7;
            margin: 0;
        }

        /* Main Dashboard */
        .dashboard {
            display: none;
            min-height: 100vh;
            padding: 20px;
        }

        .dashboard.active {
            display: block;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2rem;
            background: linear-gradient(45deg, #1e90ff, #0066cc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .mode-selector {
            display: flex;
            gap: 1rem;
        }

        .mode-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-btn.active {
            background: #1e90ff;
        }

        .widgets-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .widget {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            cursor: move;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .widget:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .widget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .widget-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .widget-icon {
            font-size: 1.5rem;
        }

        .widget-content {
            line-height: 1.6;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1e90ff;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .trending-item {
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .trending-item:last-child {
            border-bottom: none;
        }

        .game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 1rem;
        }

        .game-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .game-item:hover {
            background: rgba(30, 144, 255, 0.3);
        }

        .quick-action {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 6px;
            padding: 0.5rem 1rem;
            color: #fff;
            cursor: pointer;
            margin: 0.25rem;
            transition: all 0.3s ease;
        }

        .quick-action:hover {
            background: #1e90ff;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #1a1a1a;
            border-radius: 15px;
            padding: 2rem;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: #fff;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .input-group {
            margin-bottom: 1rem;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            opacity: 0.8;
        }

        .input-group input, .input-group textarea {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 0.75rem;
            color: #fff;
            font-size: 1rem;
        }

        .input-group input::placeholder, .input-group textarea::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .btn {
            background: #1e90ff;
            border: none;
            border-radius: 6px;
            padding: 0.75rem 1.5rem;
            color: #fff;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #0056b3;
        }

        .chat-messages {
            height: 300px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .chat-message {
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
        }

        @media (max-width: 768px) {
            .widgets-container {
                grid-template-columns: 1fr;
            }
            
            .vehicle-selection h1 {
                font-size: 2rem;
            }
            
            .header {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <div id="vehicleSelection" class="vehicle-selection">
        <h1>The Tub</h1>
        <p>Select your vehicle for optimized display</p>
        <div class="vehicle-grid">
            <div class="vehicle-option" onclick="selectVehicle('model3y')">
                <h3>Model 3 / Y</h3>
                <p>15" Landscape Display</p>
            </div>
            <div class="vehicle-option" onclick="selectVehicle('modelsx')">
                <h3>Model S / X</h3>
                <p>17" Portrait Display</p>
            </div>
            <div class="vehicle-option" onclick="selectVehicle('cybertruck')">
                <h3>Cybertruck</h3>
                <p>18.5" Landscape Display</p>
            </div>
        </div>
    </div>

    <div id="dashboard" class="dashboard">
        <div class="header">
            <h1>The Tub</h1>
            <div class="mode-selector">
                <button class="mode-btn active" onclick="setMode('default')">Default</button>
                <button class="mode-btn" onclick="setMode('charging')">Charging</button>
                <button class="mode-btn" onclick="setMode('roadtrip')">Road Trip</button>
                <button class="mode-btn" onclick="setMode('work')">Work</button>
            </div>
        </div>

        <div id="widgetsContainer" class="widgets-container">
            <!-- Weather Widget -->
            <div class="widget" data-widget="weather">
                <div class="widget-header">
                    <span class="widget-title">Weather</span>
                    <span class="widget-icon">üå§Ô∏è</span>
                </div>
                <div class="widget-content">
                    <div class="stat-value">72¬∞F</div>
                    <div class="stat-label">Partly Cloudy ‚Ä¢ Chicago, IL</div>
                    <div style="margin-top: 1rem; opacity: 0.8;">
                        High: 78¬∞F | Low: 65¬∞F<br>
                        Perfect driving weather!
                    </div>
                </div>
            </div>

            <!-- Trending Today Widget -->
            <div class="widget" data-widget="trending">
                <div class="widget-header">
                    <span class="widget-title">Trending Today</span>
                    <span class="widget-icon">üî•</span>
                </div>
                <div class="widget-content">
                    <div class="trending-item">
                        <strong>Tesla FSD Beta 12.4</strong><br>
                        <small>New autonomous driving features released</small>
                    </div>
                    <div class="trending-item">
                        <strong>Supercharger V6 Announced</strong><br>
                        <small>500kW charging speeds coming 2025</small>
                    </div>
                    <div class="trending-item">
                        <strong>Model Y Refresh Spotted</strong><br>
                        <small>Updated interior and exterior design</small>
                    </div>
                </div>
            </div>

            <!-- Quick Tools Widget -->
            <div class="widget" data-widget="quicktools">
                <div class="widget-header">
                    <span class="widget-title">Quick Tools</span>
                    <span class="widget-icon">‚ö°</span>
                </div>
                <div class="widget-content">
                    <button class="quick-action" onclick="openModal('calculator')">Calculator</button>
                    <button class="quick-action" onclick="openModal('converter')">Currency</button>
                    <button class="quick-action" onclick="openModal('notes')">Quick Notes</button>
                    <button class="quick-action" onclick="openModal('shopping')">Shopping List</button>
                    <button class="quick-action" onclick="openModal('tracker')">Package Tracker</button>
                    <button class="quick-action" onclick="openModal('onthisday')">On This Day</button>
                </div>
            </div>

            <!-- Game Center Widget -->
            <div class="widget" data-widget="games">
                <div class="widget-header">
                    <span class="widget-title">Game Center</span>
                    <span class="widget-icon">üéÆ</span>
                </div>
                <div class="widget-content">
                    <div class="game-grid">
                        <div class="game-item" onclick="launchGame('2048')">
                            <div>üéØ</div>
                            <small>2048</small>
                        </div>
                        <div class="game-item" onclick="<button onclick="window.open('snake-game.html', '_blank')">Play Snake Game</button>">
                            <div>üêç</div>
                            <small>Snake</small>
                        </div>
                        <div class="game-item" onclick="launchGame('tetris')">
                            <div>üß©</div>
                            <small>Tetris</small>
                        </div>
                        <div class="game-item" onclick="launchGame('theater')">
                            <div>üé≠</div>
                            <small>Theater</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Room Widget -->
            <div class="widget" data-widget="chat">
                <div class="widget-header">
                    <span class="widget-title">Tesla Chat</span>
                    <span class="widget-icon">üí¨</span>
                </div>
                <div class="widget-content">
                    <div class="stat-value">247</div>
                    <div class="stat-label">Owners Online</div>
                    <button class="quick-action" onclick="openModal('chat')" style="margin-top: 1rem; width: 100%;">Join Conversation</button>
                </div>
            </div>

            <!-- Smart Home Widget -->
            <div class="widget" data-widget="smarthome">
                <div class="widget-header">
                    <span class="widget-title">Smart Home</span>
                    <span class="widget-icon">üè†</span>
                </div>
                <div class="widget-content">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                        <span>Living Room</span>
                        <span style="color: #4ade80;">On</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                        <span>Garage Door</span>
                        <span style="color: #ef4444;">Closed</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Home Temp</span>
                        <span>72¬∞F</span>
                    </div>
                </div>
            </div>

            <!-- Local Events Widget -->
            <div class="widget" data-widget="events">
                <div class="widget-header">
                    <span class="widget-title">Local Events</span>
                    <span class="widget-icon">üìÖ</span>
                </div>
                <div class="widget-content">
                    <div class="trending-item">
                        <strong>Tesla Owners Meetup</strong><br>
                        <small>Saturday 2pm ‚Ä¢ Lincoln Park</small>
                    </div>
                    <div class="trending-item">
                        <strong>Chicago Auto Show</strong><br>
                        <small>This Weekend ‚Ä¢ McCormick Place</small>
                    </div>
                </div>
            </div>

            <!-- Wellness Widget -->
            <div class="widget" data-widget="wellness">
                <div class="widget-header">
                    <span class="widget-title">Drive Wellness</span>
                    <span class="widget-icon">üßò</span>
                </div>
                <div class="widget-content">
                    <button class="quick-action" onclick="startBreathing()" style="width: 100%; margin-bottom: 0.5rem;">Breathing Exercise</button>
                    <button class="quick-action" onclick="startStretching()" style="width: 100%;">Stretch Routine</button>
                    <div style="margin-top: 1rem; font-size: 0.9rem; opacity: 0.7;">
                        Perfect for charging breaks!
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="calculatorModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('calculator')">&times;</button>
            <h2>Calculator</h2>
            <div style="margin-top: 1rem;">
                <input type="text" id="calcDisplay" style="font-size: 1.5rem; text-align: right;" readonly>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem; margin-top: 1rem;">
                    <button class="btn" onclick="clearCalc()">C</button>
                    <button class="btn" onclick="appendCalc('/')">/</button>
                    <button class="btn" onclick="appendCalc('*')">*</button>
                    <button class="btn" onclick="backspaceCalc()">‚Üê</button>
                    <button class="btn" onclick="appendCalc('7')">7</button>
                    <button class="btn" onclick="appendCalc('8')">8</button>
                    <button class="btn" onclick="appendCalc('9')">9</button>
                    <button class="btn" onclick="appendCalc('-')">-</button>
                    <button class="btn" onclick="appendCalc('4')">4</button>
                    <button class="btn" onclick="appendCalc('5')">5</button>
                    <button class="btn" onclick="appendCalc('6')">6</button>
                    <button class="btn" onclick="appendCalc('+')">+</button>
                    <button class="btn" onclick="appendCalc('1')">1</button>
                    <button class="btn" onclick="appendCalc('2')">2</button>
                    <button class="btn" onclick="appendCalc('3')">3</button>
                    <button class="btn" onclick="calculateResult()" style="grid-row: span 2;">=</button>
                    <button class="btn" onclick="appendCalc('0')" style="grid-column: span 2;">0</button>
                    <button class="btn" onclick="appendCalc('.')">.</button>
                </div>
            </div>
        </div>
    </div>

    <div id="converterModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('converter')">&times;</button>
            <h2>Currency Converter</h2>
            <div style="margin-top: 1rem;">
                <div class="input-group">
                    <label>Amount</label>
                    <input type="number" id="currencyAmount" placeholder="100" value="100">
                </div>
                <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 1rem; align-items: end;">
                    <div class="input-group">
                        <label>From</label>
                        <select id="fromCurrency" class="btn" style="width: 100%; text-align: left;">
                            <option value="USD">USD - US Dollar</option>
                            <option value="EUR">EUR - Euro</option>
                            <option value="GBP">GBP - British Pound</option>
                            <option value="CAD">CAD - Canadian Dollar</option>
                            <option value="AUD">AUD - Australian Dollar</option>
                            <option value="JPY">JPY - Japanese Yen</option>
                            <option value="CHF">CHF - Swiss Franc</option>
                            <option value="CNY">CNY - Chinese Yuan</option>
                        </select>
                    </div>
                    <button class="btn" onclick="swapCurrencies()" style="padding: 0.5rem;">‚áÑ</button>
                    <div class="input-group">
                        <label>To</label>
                        <select id="toCurrency" class="btn" style="width: 100%; text-align: left;">
                            <option value="EUR">EUR - Euro</option>
                            <option value="USD">USD - US Dollar</option>
                            <option value="GBP">GBP - British Pound</option>
                            <option value="CAD">CAD - Canadian Dollar</option>
                            <option value="AUD">AUD - Australian Dollar</option>
                            <option value="JPY">JPY - Japanese Yen</option>
                            <option value="CHF">CHF - Swiss Franc</option>
                            <option value="CNY">CNY - Chinese Yuan</option>
                        </select>
                    </div>
                </div>
                <div style="margin: 2rem 0; padding: 1.5rem; background: rgba(255,255,255,0.05); border-radius: 8px; text-align: center;">
                    <div id="conversionResult" style="font-size: 1.5rem; font-weight: bold; color: #1e90ff;">
                        85.23 EUR
                    </div>
                    <div style="opacity: 0.7; margin-top: 0.5rem;">
                        1 USD = 0.8523 EUR
                    </div>
                </div>
                <button class="btn" onclick="convertCurrency()" style="width: 100%;">Convert</button>
            </div>
        </div>
    </div>

    <div id="shoppingModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('shopping')">&times;</button>
            <h2>Shopping List</h2>
            <div style="margin-top: 1rem;">
                <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                    <input type="text" id="newShoppingItem" placeholder="Add item..." style="flex: 1;" onkeypress="if(event.key==='Enter') addShoppingItem()">
                    <button class="btn" onclick="addShoppingItem()">Add</button>
                </div>
                <div id="shoppingList" style="max-height: 400px; overflow-y: auto;">
                    <!-- Shopping items will be added here -->
                </div>
                <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between;">
                    <span>Total Items: <span id="totalItems">0</span></span>
                    <button class="btn" onclick="clearShoppingList()" style="background: #ef4444;">Clear All</button>
                </div>
            </div>
        </div>
    </div>

    <div id="onthisdayModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('onthisday')">&times;</button>
            <h2>On This Day</h2>
            <div style="margin-top: 1rem;">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <div style="font-size: 1.5rem; color: #1e90ff;" id="todayDate">June 12</div>
                    <div style="opacity: 0.7;">Historical Events & Fun Facts</div>
                </div>
                <div id="onThisDayContent">
                    <!-- Historical events will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <div id="notesModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('notes')">&times;</button>
            <h2>Quick Notes</h2>
            <div class="input-group">
                <textarea id="quickNotes" rows="10" placeholder="Jot down your thoughts..."></textarea>
            </div>
            <button class="btn" onclick="saveNotes()">Save Notes</button>
        </div>
    </div>

    <div id="chatModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('chat')">&times;</button>
            <h2>Tesla Owners Chat</h2>
            <div class="chat-messages" id="chatMessages">
                <div class="chat-message">
                    <strong>Model3Owner:</strong> Just finished a road trip from LA to Vegas. Supercharging was flawless!
                </div>
                <div class="chat-message">
                    <strong>CybertruckFan:</strong> Anyone know when the next software update drops?
                </div>
                <div class="chat-message">
                    <strong>TeslaEnthusiast:</strong> Love this new hub! Great way to stay connected while charging.
                </div>
            </div>
            <div style="display: flex; gap: 0.5rem;">
                <input type="text" id="chatInput" placeholder="Keep it friendly and Tesla-related..." style="flex: 1;">
                <button class="btn" onclick="sendChatMessage()">Send</button>
            </div>
        </div>
    </div>

    <script>
        let currentVehicle = '';
        let currentMode = 'default';
        let calcDisplay = '';
        let shoppingItems = [];

        // Exchange rates (static for offline use - in production would fetch from API)
        const exchangeRates = {
            USD: { EUR: 0.8523, GBP: 0.7834, CAD: 1.3456, AUD: 1.4721, JPY: 110.23, CHF: 0.9123, CNY: 6.4567 },
            EUR: { USD: 1.1734, GBP: 0.8567, CAD: 1.5789, AUD: 1.6234, JPY: 129.45, CHF: 1.0678, CNY: 7.5678 },
            GBP: { USD: 1.2763, EUR: 1.1672, CAD: 1.7234, AUD: 1.8765, JPY: 140.67, CHF: 1.1567, CNY: 8.2345 },
            CAD: { USD: 0.7432, EUR: 0.6345, GBP: 0.5801, AUD: 1.0934, JPY: 81.89, CHF: 0.6789, CNY: 4.7890 },
            AUD: { USD: 0.6791, EUR: 0.6167, GBP: 0.5329, CAD: 0.9145, JPY: 74.89, CHF: 0.6203, CNY: 4.3876 },
            JPY: { USD: 0.0091, EUR: 0.0077, GBP: 0.0071, CAD: 0.0122, AUD: 0.0134, CHF: 0.0083, CNY: 0.0586 },
            CHF: { USD: 1.0962, EUR: 0.9365, GBP: 0.8645, CAD: 1.4734, AUD: 1.6123, JPY: 120.78, CNY: 7.0789 },
            CNY: { USD: 0.1549, EUR: 0.1321, GBP: 0.1214, CAD: 0.2088, AUD: 0.2279, JPY: 17.06, CHF: 0.1412 }
        };

        // Historical events database (sample data)
        const historicalEvents = {
            "6-12": [
                { year: 1963, event: "Civil rights leader Medgar Evers was assassinated in Mississippi" },
                { year: 1991, event: "Russian Federation was established as Boris Yeltsin was elected president" },
                { year: 1994, event: "Nicole Brown Simpson and Ronald Goldman were murdered" },
                { year: 2016, event: "The deadliest mass shooting in US history occurred at Pulse nightclub in Orlando" },
                { year: 1929, event: "Anne Frank was born in Frankfurt, Germany" },
                { year: 1967, event: "The Supreme Court case Loving v. Virginia struck down laws banning interracial marriage" }
            ],
            "6-13": [
                { year: 1983, event: "Pioneer 10 became the first spacecraft to leave the solar system" },
                { year: 1966, event: "The Supreme Court issued the Miranda v. Arizona decision" },
                { year: 1944, event: "Germany launched the first V-1 flying bomb attack on Britain" }
            ]
            // Add more dates as needed
        };

        // Vehicle Selection
        function selectVehicle(vehicle) {
            currentVehicle = vehicle;
            document.getElementById('vehicleSelection').style.display = 'none';
            document.getElementById('dashboard').classList.add('active');
            
            // Adjust layout based on vehicle
            adjustLayoutForVehicle(vehicle);
        }

        function adjustLayoutForVehicle(vehicle) {
            const container = document.getElementById('widgetsContainer');
            
            switch(vehicle) {
                case 'model3y':
                    container.style.gridTemplateColumns = 'repeat(auto-fit, minmax(280px, 1fr))';
                    break;
                case 'modelsx':
                    container.style.gridTemplateColumns = 'repeat(auto-fit, minmax(320px, 1fr))';
                    break;
                case 'cybertruck':
                    container.style.gridTemplateColumns = 'repeat(auto-fit, minmax(300px, 1fr))';
                    break;
            }
        }

        // Mode Management
        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Show/hide widgets based on mode
            const widgets = document.querySelectorAll('.widget');
            widgets.forEach(widget => {
                widget.style.display = 'block';
                switch(mode) {
                    case 'charging':
                        if (!['weather', 'trending', 'games', 'wellness', 'chat'].includes(widget.dataset.widget)) {
                            widget.style.display = 'none';
                        }
                        break;
                    case 'work':
                        if (!['quicktools', 'weather', 'smarthome'].includes(widget.dataset.widget)) {
                            widget.style.display = 'none';
                        }
                        break;
                    case 'roadtrip':
                        if (!['weather', 'events', 'wellness', 'quicktools'].includes(widget.dataset.widget)) {
                            widget.style.display = 'none';
                        }
                        break;
                }
            });
        }

        // Modal Management
        function openModal(modalType) {
            document.getElementById(modalType + 'Modal').classList.add('active');
            
            if (modalType === 'notes') {
                const savedNotes = getStoredData('teslaHubNotes') || '';
                document.getElementById('quickNotes').value = savedNotes;
            } else if (modalType === 'shopping') {
                loadShoppingList();
            } else if (modalType === 'converter') {
                convertCurrency(); // Show initial conversion
            } else if (modalType === 'onthisday') {
                loadOnThisDay();
            }
        }

        function closeModal(modalType) {
            document.getElementById(modalType + 'Modal').classList.remove('active');
        }

        // Calculator Functions
        function appendCalc(value) {
            calcDisplay += value;
            document.getElementById('calcDisplay').value = calcDisplay;
        }

        function clearCalc() {
            calcDisplay = '';
            document.getElementById('calcDisplay').value = '';
        }

        function backspaceCalc() {
            calcDisplay = calcDisplay.slice(0, -1);
            document.getElementById('calcDisplay').value = calcDisplay;
        }

        function calculateResult() {
            try {
                const result = eval(calcDisplay);
                calcDisplay = result.toString();
                document.getElementById('calcDisplay').value = calcDisplay;
            } catch (e) {
                document.getElementById('calcDisplay').value = 'Error';
                calcDisplay = '';
            }
        }

        // Notes Functions
        function saveNotes() {
            const notes = document.getElementById('quickNotes').value;
            storeData('teslaHubNotes', notes);
            alert('Notes saved!');
            closeModal('notes');
        }

        // Currency Converter Functions
        function convertCurrency() {
            const amount = parseFloat(document.getElementById('currencyAmount').value) || 100;
            const from = document.getElementById('fromCurrency').value;
            const to = document.getElementById('toCurrency').value;
            
            let convertedAmount;
            let rate;
            
            if (from === to) {
                convertedAmount = amount;
                rate = 1;
            } else if (from === 'USD') {
                rate = exchangeRates.USD[to];
                convertedAmount = amount * rate;
            } else if (to === 'USD') {
                rate = 1 / exchangeRates.USD[from];
                convertedAmount = amount * rate;
            } else {
                // Convert through USD
                const toUSD = amount / exchangeRates.USD[from];
                convertedAmount = toUSD * exchangeRates.USD[to];
                rate = exchangeRates.USD[to] / exchangeRates.USD[from];
            }
            
            document.getElementById('conversionResult').textContent = 
                `${convertedAmount.toFixed(2)} ${to}`;
            document.querySelector('#converterModal .modal-content div:nth-of-type(4) div:nth-of-type(2)').textContent = 
                `1 ${from} = ${rate.toFixed(4)} ${to}`;
        }

        function swapCurrencies() {
            const fromSelect = document.getElementById('fromCurrency');
            const toSelect = document.getElementById('toCurrency');
            const temp = fromSelect.value;
            fromSelect.value = toSelect.value;
            toSelect.value = temp;
            convertCurrency();
        }

        // Shopping List Functions
        function loadShoppingList() {
            shoppingItems = getStoredData('shoppingItems') || [];
            renderShoppingList();
        }

        function addShoppingItem() {
            const input = document.getElementById('newShoppingItem');
            const item = input.value.trim();
            
            if (item) {
                shoppingItems.push({
                    id: Date.now(),
                    text: item,
                    completed: false,
                    addedAt: new Date().toLocaleString()
                });
                input.value = '';
                storeData('shoppingItems', shoppingItems);
                renderShoppingList();
            }
        }

        function toggleShoppingItem(id) {
            const item = shoppingItems.find(item => item.id === id);
            if (item) {
                item.completed = !item.completed;
                storeData('shoppingItems', shoppingItems);
                renderShoppingList();
            }
        }

        function removeShoppingItem(id) {
            shoppingItems = shoppingItems.filter(item => item.id !== id);
            storeData('shoppingItems', shoppingItems);
            renderShoppingList();
        }

        function clearShoppingList() {
            if (confirm('Clear all items?')) {
                shoppingItems = [];
                storeData('shoppingItems', shoppingItems);
                renderShoppingList();
            }
        }

        function renderShoppingList() {
            const container = document.getElementById('shoppingList');
            const totalItems = document.getElementById('totalItems');
            
            totalItems.textContent = shoppingItems.length;
            
            if (shoppingItems.length === 0) {
                container.innerHTML = '<div style="text-align: center; opacity: 0.5; padding: 2rem;">No items yet. Add your first item above!</div>';
                return;
            }
            
            container.innerHTML = shoppingItems.map(item => `
                <div style="display: flex; align-items: center; padding: 0.75rem; background: rgba(255,255,255,0.03); border-radius: 6px; margin-bottom: 0.5rem; ${item.completed ? 'opacity: 0.5;' : ''}">
                    <input type="checkbox" ${item.completed ? 'checked' : ''} 
                           onchange="toggleShoppingItem(${item.id})" 
                           style="margin-right: 0.75rem; transform: scale(1.2);">
                    <span style="flex: 1; ${item.completed ? 'text-decoration: line-through;' : ''}">${item.text}</span>
                    <button onclick="removeShoppingItem(${item.id})" 
                            style="background: #ef4444; border: none; border-radius: 4px; padding: 0.25rem 0.5rem; color: white; cursor: pointer;">√ó</button>
                </div>
            `).join('');
        }

        // On This Day Functions
        function loadOnThisDay() {
            const today = new Date();
            const month = today.getMonth() + 1;
            const day = today.getDate();
            const dateKey = `${month}-${day}`;
            
            document.getElementById('todayDate').textContent = 
                today.toLocaleDateString('en-US', { month: 'long', day: 'numeric' });
            
            const events = historicalEvents[dateKey] || [
                { year: new Date().getFullYear() - 1, event: "No historical events found for this date in our database." }
            ];
            
            const container = document.getElementById('onThisDayContent');
            container.innerHTML = events.map(event => `
                <div style="padding: 1rem; background: rgba(255,255,255,0.03); border-radius: 8px; margin-bottom: 1rem; border-left: 3px solid #1e90ff;">
                    <div style="font-weight: bold; color: #1e90ff; margin-bottom: 0.5rem;">${event.year}</div>
                    <div>${event.event}</div>
                </div>
            `).join('');
        }

        // Storage helper functions (using variables instead of localStorage for Tesla compatibility)
        let appStorage = {};
        
        function storeData(key, data) {
            appStorage[key] = data;
        }
        
        function getStoredData(key) {
            return appStorage[key];
        }

        // Chat Functions
        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message && message.length <= 100) {
                const chatMessages = document.getElementById('chatMessages');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-message';
                messageDiv.innerHTML = `<strong>You:</strong> ${message}`;
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                input.value = '';
            } else {
                alert('Message must be 100 characters or less');
            }
        }

        // Game Functions
        function launchGame(game) {
            if (game === 'theater') {
                window.open('https://abettertheater.com', '_blank');
            } else {
                alert(`Launching ${game}... (Game integration coming soon!)`);
            }
        }

        // Wellness Functions
        function startBreathing() {
            alert('üßò Starting 4-7-8 breathing exercise...\n\nInhale for 4 seconds\nHold for 7 seconds\nExhale for 8 seconds\n\nRepeat 4 times');
        }

        function startStretching() {
            alert('ü§∏ Starting 5-minute stretch routine...\n\n1. Neck rolls\n2. Shoulder shrugs\n3. Seated spinal twist\n4. Ankle circles\n5. Deep breathing\n\nPerfect for charging breaks!');
        }

        // Initialize drag and drop (simplified version)
        document.addEventListener('DOMContentLoaded', function() {
            // Add touch support for Tesla browsers
            let touchStartPos = null;
            
            document.addEventListener('touchstart', function(e) {
                touchStartPos = {x: e.touches[0].clientX, y: e.touches[0].clientY};
            });
            
            // Auto-update time-sensitive widgets
            setInterval(updateWidgets, 60000); // Update every minute
            
            // Add event listeners for currency converter
            document.getElementById('currencyAmount').addEventListener('input', convertCurrency);
            document.getElementById('fromCurrency').addEventListener('change', convertCurrency);
            document.getElementById('toCurrency').addEventListener('change', convertCurrency);
        });

        function updateWidgets() {
            // Update weather, time, etc.
            // In a real app, this would fetch live data
        }

        // Easter egg: Konami code for developer mode
        let konamiCode = [];
        const konamiSequence = [38, 38, 40, 40, 37, 39, 37, 39, 66, 65];
        
        document.addEventListener('keydown', function(e) {
            konamiCode.push(e.keyCode);
            if (konamiCode.length > konamiSequence.length) {
                konamiCode.shift();
            }
            
            if (konamiCode.join(',') === konamiSequence.join(',')) {
                document.body.style.animation = 'rainbow 2s infinite';
                setTimeout(() => document.body.style.animation = '', 5000);
            }
        });
    </script>

    <style>
        @keyframes rainbow {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }
    </style>
</body>
</html>
